---
import Layout from "../../layouts/Layout.astro";
import CalculatorShell from "../../components/calculators/CalculatorShell.astro";
import InputNumber from "../../components/calculators/InputNumber.astro";
import BinaryToggle from "../../components/calculators/BinaryToggle.astro";
import RelatedTools from "../../components/RelatedTools.astro";
import ToolContent from "../../components/ToolContent.astro";
import { formatUYU } from "../../lib/calculations/utils";
import { breadcrumbSchema } from "../../lib/seo/breadcrumbSchema";
import Breadcrumbs from "../../components/Breadcrumbs.astro";

const breadcrumbs = [
    { name: "Inicio", url: "/" },
    { name: "Calculadoras", url: "/calculadoras" },
    {
        name: "Indemnización por Despido",
        url: "/calculadoras/indemnizacion-despido-uruguay",
    },
];

const schema = breadcrumbSchema(breadcrumbs);
---

<Layout
    title="Calculadora Indemnización por Despido Uruguay - CalculaEasy"
    description="Calculadora de indemnización por despido común en Uruguay. Estimá el monto según tu antigüedad y salario mensual."
    canonical="https://calculaeasy.com/calculadoras/indemnizacion-despido-uruguay"
    schema={schema}
>
    <div class="bg-indigo-50 min-h-screen py-12">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl">
            <Breadcrumbs items={breadcrumbs} />

            <CalculatorShell
                title="Calculadora de Indemnización por Despido"
                description="Estimá tu indemnización por despido común según la legislación uruguaya. Calculá según antigüedad y salario mensual."
            >
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12">
                    <!-- Form -->
                    <div>
                        <div class="space-y-6">
                            <InputNumber
                                label="Salario Mensual (Nominal)"
                                name="salary"
                                placeholder="Ej: 50000"
                                min={0}
                            />

                            <!-- Fecha de Ingreso -->
                            <div class="mb-6">
                                <label
                                    for="startDate"
                                    class="block text-sm font-semibold text-slate-700 mb-2"
                                >
                                    Fecha de Ingreso
                                </label>
                                <input
                                    type="date"
                                    name="startDate"
                                    id="startDate"
                                    class="block w-full px-4 py-4 rounded-xl border-slate-200 bg-slate-50 text-slate-900 focus:border-indigo-500 focus:ring-indigo-500 hover:border-indigo-300 transition-colors shadow-sm text-lg"
                                />
                            </div>

                            <!-- Fecha de Egreso -->
                            <div class="mb-6">
                                <label
                                    for="endDate"
                                    class="block text-sm font-semibold text-slate-700 mb-2"
                                >
                                    Fecha de Egreso
                                </label>
                                <input
                                    type="date"
                                    name="endDate"
                                    id="endDate"
                                    class="block w-full px-4 py-4 rounded-xl border-slate-200 bg-slate-50 text-slate-900 focus:border-indigo-500 focus:ring-indigo-500 hover:border-indigo-300 transition-colors shadow-sm text-lg"
                                />
                            </div>

                            <BinaryToggle
                                label="Fracción mayor a 3 meses cuenta como 1 año"
                                name="countFraction"
                                options={[
                                    { label: "Sí", value: 1 },
                                    { label: "No", value: 0 },
                                ]}
                            />
                        </div>
                    </div>

                    <!-- Results -->
                    <div>
                        <!-- Main Result Card -->
                        <div
                            class="mt-8 bg-indigo-50 rounded-2xl p-6 sm:p-8 border border-indigo-100"
                        >
                            <div
                                class="flex flex-col items-center justify-center text-center"
                            >
                                <span
                                    class="text-sm font-semibold uppercase tracking-wider text-indigo-600 mb-1"
                                >
                                    Indemnización Estimada
                                </span>
                                <div class="flex items-baseline gap-1 my-2">
                                    <span
                                        class="text-4xl sm:text-5xl font-extrabold text-slate-900"
                                        id="result-indemnity"
                                    >
                                        $ 0
                                    </span>
                                </div>
                                <div
                                    class="h-1 w-20 bg-indigo-200 rounded-full my-4"
                                >
                                </div>
                            </div>

                            <div class="space-y-3 mt-4 text-sm sm:text-base">
                                <div
                                    class="flex justify-between items-center py-2 border-b border-indigo-200/50"
                                >
                                    <span class="text-slate-600"
                                        >Antigüedad</span
                                    >
                                    <span
                                        class="font-medium text-slate-900"
                                        id="result-seniority"
                                        >0 años, 0 meses</span
                                    >
                                </div>
                                <div
                                    class="flex justify-between items-center py-2 border-b border-indigo-200/50"
                                >
                                    <span class="text-slate-600"
                                        >Meses Computables (sin tope)</span
                                    >
                                    <span
                                        class="font-medium text-slate-900"
                                        id="result-raw-months">0</span
                                    >
                                </div>
                                <div
                                    class="flex justify-between items-center py-2 border-b border-indigo-200/50"
                                >
                                    <span class="text-slate-600"
                                        >Meses de Indemnización</span
                                    >
                                    <span
                                        class="font-medium text-slate-900"
                                        id="result-indemnity-months">0</span
                                    >
                                </div>
                                <div
                                    class="flex justify-between items-center py-2 border-b border-indigo-200/50"
                                >
                                    <span class="text-slate-600"
                                        >Tope Aplicado (máx. 6)</span
                                    >
                                    <span
                                        class="font-medium text-slate-900"
                                        id="result-cap">No</span
                                    >
                                </div>
                                <div
                                    class="flex justify-between items-center py-2 pt-3 font-semibold"
                                >
                                    <span class="text-indigo-600"
                                        >Salario de Referencia</span
                                    >
                                    <span
                                        class="text-indigo-600"
                                        id="result-salary">$ 0</span
                                    >
                                </div>
                            </div>
                        </div>

                        <div
                            class="mt-6 p-4 bg-yellow-50 rounded-xl border border-yellow-100 text-sm text-yellow-800"
                        >
                            <strong>Importante:</strong> Esta calculadora estima únicamente
                            la indemnización por despido común. NO incluye liquidación
                            final (días trabajados del mes, aguinaldo proporcional,
                            licencia no gozada, salario vacacional, etc.). Consultá
                            con un profesional para un cálculo completo.
                        </div>
                    </div>
                </div>
            </CalculatorShell>
            <ToolContent toolId="indemnizacion-despido-uruguay" />
            <RelatedTools currentTool="indemnizacion-despido-uruguay" />
        </div>
    </div>
</Layout>

<script>
    import { calculateSeverance } from "../../lib/calculations/uy/severance/severance";
    import { formatUYU } from "../../lib/calculations/utils";

    // DOM Elements
    const salaryInput = document.querySelector(
        'input[name="salary"]',
    ) as HTMLInputElement;
    const startDateInput = document.querySelector(
        'input[name="startDate"]',
    ) as HTMLInputElement;
    const endDateInput = document.querySelector(
        'input[name="endDate"]',
    ) as HTMLInputElement;
    const countFractionSelect = document.querySelector(
        'select[name="countFraction"]',
    ) as HTMLSelectElement;

    const resultIndemnity = document.getElementById("result-indemnity");
    const resultSeniority = document.getElementById("result-seniority");
    const resultRawMonths = document.getElementById("result-raw-months");
    const resultIndemnityMonths = document.getElementById(
        "result-indemnity-months",
    );
    const resultCap = document.getElementById("result-cap");
    const resultSalary = document.getElementById("result-salary");

    // Set default dates
    function initializeDates() {
        const today = new Date();
        const oneYearAgo = new Date(today);
        oneYearAgo.setFullYear(oneYearAgo.getFullYear() - 1);

        // Format to YYYY-MM-DD
        const formatDate = (date: Date) => date.toISOString().split("T")[0];

        if (!startDateInput.value) {
            startDateInput.value = formatDate(oneYearAgo);
        }
        if (!endDateInput.value) {
            endDateInput.value = formatDate(today);
        }
    }

    function recalculate() {
        const salary = parseFloat(salaryInput.value) || 0;
        const startDate = startDateInput.value;
        const endDate = endDateInput.value;
        const countFraction = parseInt(countFractionSelect.value) === 1;

        if (!startDate || !endDate) {
            return;
        }

        const result = calculateSeverance({
            salaryMonthlyUYU: salary,
            startDateISO: startDate,
            endDateISO: endDate,
            countFractionOver3Months: countFraction,
            maxMonthsCap: 6,
        });

        // Update UI
        if (resultIndemnity)
            resultIndemnity.innerText = formatUYU(result.indemnityUYU);
        if (resultSeniority)
            resultSeniority.innerText = `${result.seniority.years} año${result.seniority.years !== 1 ? "s" : ""}, ${result.seniority.months} mes${result.seniority.months !== 1 ? "es" : ""}`;
        if (resultRawMonths)
            resultRawMonths.innerText = result.indemnityRawMonths.toString();
        if (resultIndemnityMonths)
            resultIndemnityMonths.innerText = result.indemnityMonths.toString();
        if (resultCap) resultCap.innerText = result.capApplied ? "Sí" : "No";
        if (resultSalary)
            resultSalary.innerText = formatUYU(result.salaryMonthlyUYU);
    }

    // Event Listeners
    salaryInput?.addEventListener("input", recalculate);
    startDateInput?.addEventListener("change", recalculate);
    endDateInput?.addEventListener("change", recalculate);
    countFractionSelect?.addEventListener("change", recalculate);

    // Initialize
    initializeDates();
    recalculate();
</script>
